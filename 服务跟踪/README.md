
* [服务追踪](#服务追踪)
* [服务追踪的作⽤](#服务追踪的作⽤)


---

# 服务追踪
    如果有⼀个系统，可以跟踪记录⼀次⽤户请求都发起了哪些调⽤，经过哪些服务处理，并且记录每⼀次调⽤所涉及的服务的详细信息，这时候如果发⽣调⽤失败，你
    就可以通过这个⽇志快速定位是在哪个环节出了问题，这个系统就是今天我要讲解的服务追踪系统
    
    除了需要对服务调⽤情况进⾏监控之外，你还需要记录服务调⽤经过的每⼀层链路，以便进⾏问题追踪和故障定位。服务追踪的⼯作原理⼤致如下：
    
    服务消费者发起调⽤前，会在本地按照⼀定的规则⽣成⼀个requestid，发起调⽤时，将requestid当作请求参数的⼀部分，传递给服务提供者。
    
    服务提供者接收到请求后，记录下这次请求的requestid，然后处理请求。如果服务提供者继续请求其他服务，会在本地再⽣成⼀个⾃⼰的requestid，然后把这
    两个requestid都当作请求参数继续往下传递。
    
    以此类推，通过这种层层往下传递的⽅式，⼀次请求，⽆论最后依赖多少次服务调⽤、经过多少服务节点，都可以通过最开始⽣成的requestid串联所有节点，从
    ⽽达到服务追踪的⽬的。

# 服务追踪的作⽤

    第⼀，优化系统瓶颈。
    
    通过记录调⽤经过的每⼀条链路上的耗时，我们能快速定位整个系统的瓶颈点在哪⾥。⽐如你访问微博⾸⻚发现很慢，肯定是由于某种原因造成的，有可能是运营
    商⽹络延迟，有可能是⽹关系统异常，有可能是某个服务异常，还有可能是缓存或者数据库异常。通过服务追踪，可以从全局视⻆上去观察，找出整个系统的瓶颈
    点所在，然后做出针对性的优化。
    
    第⼆，优化链路调⽤。
    
    通过服务追踪可以分析调⽤所经过的路径，然后评估是否合理。⽐如⼀个服务调⽤下游依赖了多个服务，通过调⽤链分析，可以评估是否每个依赖都是必要的，是
    否可以通过业务优化来减少服务依赖。
    
    第三，⽣成⽹络拓扑。
    
    通过服务追踪系统中记录的链路信息，可以⽣成⼀张系统的⽹络调⽤拓扑图，它可以反映系统都依赖了哪些服务，以及服务之间的调⽤关系是什么样的，可以⼀⽬
    了然。除此之外，在⽹络拓扑图上还可以把服务调⽤的详细信息也标出来，也能起到服务监控的作⽤。
    
    第四，透明传输数据。
    
    除了服务追踪，业务上经常有⼀种需求，期望能把⼀些⽤户数据，从调⽤的开始⼀直往下传递，以便系统中的各个服务都能获取到这个信息。⽐如业务想做⼀些A/B
    测试，这时候就想通过服务追踪系统，把A/B测试的开关逻辑⼀直往下传递，经过的每⼀层服务都能获取到这个开关值，就能够统⼀进⾏A/B测试。
    
